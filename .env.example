# Example Environment Configuration
# Copy this file to .env.<environment> and update with your values
# Example: cp .env.example .env.dev
# 
# For detailed deployment guide, see: docs/DEPLOYMENT.md

# Azure Configuration (Required)
AZURE_SUBSCRIPTION_ID=your-azure-subscription-id
AZURE_RESOURCE_GROUP=your-resource-group-name

# APIM Configuration (Required)
APIM_VALIDATION_KEY=your-base64-encoded-validation-key
APIM_PORTAL_URL=https://your-apim.developer.azure-api.net

# OIDC Provider Configuration (Required)
OIDC_ISSUER=https://your-domain.okta.com
OIDC_CLIENT_ID=your-oidc-client-id
OIDC_CLIENT_SECRET=your-oidc-client-secret

# Deployment Configuration (Optional - defaults shown)
APP_NAME=apim-delegation
AZURE_LOCATION=eastus2
AZURE_SKU=FC1
AZURE_OS_TYPE=linux
RUNTIME=node

# SKU Options:
# Y1 - Classic Consumption (Windows only, cost-effective)
# FC1 - Flex Consumption (Windows/Linux, modern, recommended)
# EP1 - Premium (Windows/Linux, guaranteed performance)
# EP2 - Premium (Windows/Linux, 2 cores)
# EP3 - Premium (Windows/Linux, 4 cores)

# OS Type Options:
# windows - Windows deployment
# linux - Linux deployment (recommended for Node.js 22)
# Note: Y1 only supports Windows

# APIM Configuration
# Choose ONE of the scenarios below based on your setup:

# SCENARIO 1: Same Subscription APIM (Recommended - Uses Managed Identity)
# Use when Function App and APIM are in the same subscription
# The Bicep template automatically grants the Function App's managed identity
# the necessary permissions to access APIM Management API
APIM_RESOURCE_GROUP=your-apim-resource-group
APIM_SERVICE_NAME=your-apim-service-name
# APIM_ACCESS_TOKEN not needed - managed identity handles authentication

# SCENARIO 2: Cross-Subscription APIM (Advanced - Uses Manual Token)
# Use when Function App and APIM are in different subscriptions
# You must provide a manual access token and manage token refresh
# APIM_RESOURCE_GROUP=your-apim-resource-group  # In different subscription
# APIM_SERVICE_NAME=your-apim-service-name      # In different subscription
# APIM_ACCESS_TOKEN=your-azure-bearer-token     # Required for cross-subscription

# Custom OIDC Endpoints (Optional - auto-discovered if not provided)
# OIDC_AUTHORIZATION_ENDPOINT=/oauth2/authorize
# OIDC_TOKEN_ENDPOINT=/oauth2/token
# OIDC_USERINFO_ENDPOINT=/oauth2/userinfo
# OIDC_END_SESSION_ENDPOINT=/oauth2/logout

# Provider-specific Examples:
# 
# Okta:
# OIDC_ISSUER=https://your-domain.okta.com
#
# Azure AD/Entra ID:
# OIDC_ISSUER=https://login.microsoftonline.com/{tenant-id}/v2.0
#
# Google Identity:
# OIDC_ISSUER=https://accounts.google.com
#
# Auth0:
# OIDC_ISSUER=https://{your-domain}.auth0.com
#
# AWS Cognito:
# OIDC_ISSUER=https://cognito-idp.{region}.amazonaws.com/{user-pool-id}

# How to get APIM_ACCESS_TOKEN:
# 
# Option 1: Service Principal (Recommended for production)
# az ad sp create-for-rbac --name "apim-delegation-sp" --role "API Management Service Contributor" --scopes "/subscriptions/{subscription-id}/resourceGroups/{apim-resource-group}"
# Use the output to generate a bearer token
# 
# Option 2: Personal Access Token (Testing only)
# az account get-access-token --resource=https://management.azure.com/ --query accessToken -o tsv
# 
# Option 3: Azure CLI (Testing only)
# az account get-access-token --query accessToken -o tsv